#!/usr/bin/env bash
set -euo pipefail
VERSION="8.7"
BASE_URL="https://services.gradle.org/distributions"
ZIP="gradle-$VERSION-bin.zip"
DEST_DIR="$(pwd)/.tools/gradle-$VERSION"
ZIP_PATH="$(pwd)/.tools/$ZIP"

if [ ! -d "$DEST_DIR" ]; then
  echo "[gw] Gradle $VERSION not found. Downloading..."
  mkdir -p "$(pwd)/.tools"
  if command -v curl >/dev/null 2>&1; then
    curl -L "$BASE_URL/$ZIP" -o "$ZIP_PATH"
  elif command -v wget >/dev/null 2>&1; then
    wget "$BASE_URL/$ZIP" -O "$ZIP_PATH"
  else
    echo "[gw] Need curl or wget to download Gradle." >&2
    exit 1
  fi
  echo "[gw] Unpacking..."
  unzip -q "$ZIP_PATH" -d "$(pwd)/.tools"
  mv "$(pwd)/.tools/gradle-$VERSION" "$DEST_DIR" 2>/dev/null || true
fi

exec "$DEST_DIR/bin/gradle" --no-daemon "$@"

